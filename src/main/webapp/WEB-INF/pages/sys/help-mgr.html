<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>帮助管理</title>
    <link href="../../../plugin/bstable/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../../../plugin/bstable/css/bootstrap-table.css" rel="stylesheet" type="text/css">
    <link href="../../../css/user.css" rel="stylesheet" type="text/css">
    <link href="../../../css/news.css" rel="stylesheet" type="text/css" />
    <style>
        .mould-content{display: flex;padding: 0}
        .mould-left{flex: 0 0 24%;background-color: #fff;border-radius: 6px;height: 100%;overflow-y: auto}
        .mould-right{flex: 1;margin-left: 4px;background-color: #fff;padding: 10px;border-radius: 6px}
    </style>
</head>
<body style="font-family: 微软雅黑;color: #475059;min-width: 1150px;overflow: auto">
    <div class="mould-main">
        <div class="mould-top">
            <p>帮助管理主要包含用户条款 隐私政策 常见问题等编辑管理。</p>
        </div>
        <div class="mould-middle">
            <div class="mould-content">
                <div class="mould-left">
                    <h6>栏目</h6>
                    <ul class="log_nav">
                        <li type="1" table="yhtk" class="log_active">用户条款</li>
                        <li type="2" table="yszc">隐私政策</li>
                        <li type="3" table="cjwt">常见问题</li>
                    </ul>
                </div>
                <div class="mould-right">
                    <div class="mould-search">
                        <div class="mould-items">
                            <div class="mould-item">
                                <div class="item-text">
                                    操作
                                </div>
                                <div class="item-input">
                                    <input type="text" id="operation"/>
                                </div>
                            </div>
                            <div class="clear"></div>
                        </div>
                    </div>
                    <div class="mould-btn">
                        <div class="btn-item btn-add sysUser">新增</div>
                        <div class="btn-item btn-query">查询</div>
                        <div class="btn-item btn-edit">编辑</div>
                        <div class="btn-item btn-batchDelete">删除</div>
                    </div>
                    <ul class="news_table">
                        <li>
                            <table id="yhtk" class="table_style" style="margin: 0 auto" ></table>
                        </li>
                        <li style="display: none">
                            <table id="yszc" class="table_style" style="margin: 0 auto" ></table>
                        </li>
                        <li style="display: none">
                            <table id="cjwt" class="table_style" style="margin: 0 auto" ></table>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="mould-bottom">
            <p>Copyright©2013-2018 沪IPC备11000002000001号</p>
        </div>
    </div>
    <script src="../../../js/jquery-2.2.0.min.js"></script>
    <script src="../../../plugin/bstable/js/bootstrap.min.js"></script>
    <script src="../../../plugin/bstable/js/bootstrap-table.js"></script>
    <script src="../../../plugin/bstable/js/bootstrap-table-zh-CN.min.js"></script>
    <script src="../../../plugin/layer_v2.1/layer/layer.js"></script>
    <script type="text/javascript">
        var table = "login";
        $(function () {
            //默认加载登录日志
            loadNewsList(1);

            //新增按钮
            $(".btn-add").on("click",function () {
                layer.open({
                    type: 2,
                    title: '新增公告',
                    shade: 0.5,
                    skin: 'layui-layer-rim',
                    area: ['900px', '550px'],
                    shadeClose: false,
                    closeBtn: 2,
                    content: '/page/sys/help-add.shtm'
                });
            });
            //编辑商品
            $(".btn-edit").on("click",function(){
                var selections = $("#"+table).bootstrapTable('getSelections');
                if(selections.length == 0 || selections.length > 1){
                    layer.msg("请选择一条数据进行操作");
                    return;
                }else{
                    var id = selections[0].id;
                    layer.open({
                        type: 2,
                        title: '新增公告',
                        shade: 0.5,
                        skin: 'layui-layer-rim',
                        area: ['900px', '550px'],
                        shadeClose: false,
                        closeBtn: 2,
                        content: '/page/news/help-update.shtm?id='+id
                    });
                }
            });
            //日志类型标签切换
            $(".log_nav li").each(function(index){
                $(this).click(function(){
                    $(".log_nav li").removeClass("log_active");
                    $(this).addClass("log_active");
                    $(".news_table>li").eq(index).show().siblings("li").stop().hide();
                    var type = $(this).attr("type");
                    loadNewsList(type);
                })
            });
            //查询按钮
            $(".btn-query").on("click", function () {
                $("#"+table).bootstrapTable('refresh');
            });
            //批量删除
            $(".btn-batchDelete").on("click",function () {
                var selections = $("#"+table).bootstrapTable('getSelections');
                if(selections.length == 0){
                    layer.msg("请选择一条数据进行操作");
                    return;
                }else{
                    var arry=[];
                    $.each(selections,function (index,row) {
                        arry.push(row.id);
                    });
                    layer.confirm('是否确定删除?', {
                        title: '提示',
                        btn: ['确定', '取消'] //按钮
                    }, function (index) {
                        $.ajax({
                            url:'/sys/news/batchDelete.shtm',
                            type:'POST',
                            dataType:"json",
                            data:JSON.stringify({ids:arry.join(",")}),
                            contentType: "application/json; charset=utf-8",
                            success:function (result) {
                                layer.msg(result.msg);
                                $("#"+table).bootstrapTable('refresh');
                            }
                        });
                    }, function (index) {
                        layer.close(index);
                    });
                }
            });
        });

        /**
         * 根据日志类型加载日志列表
         * @param type
         */
        function loadNewsList(type){
            if(type==1){table="yhtk";}
            if(type==2){table="yszc";}
            if(type==3){table="cjwt";}
            $('#'+table).bootstrapTable({
                method: "post",
                striped: false,
                singleSelect: false,
                url: "/sys/news/list.shtm",
                dataType: "json",
                pagination: true, //分页
                pageSize: 10,
                pageNumber: 1,
                search: false, //显示搜索框
                contentType: "application/x-www-form-urlencoded",
                sidePagination: "server", //服务端请求
                clickToSelect : true, //是否启用点击选中行
                queryParams:function(params) {
                    return {
                        pageNum: params.offset/params.limit+1,
                        pageSize: params.limit,//页码大小
                        content:$("#operation").val(),
                        type:type
                    };
                },
                //返回数据格式处理
                responseHandler: function(res) {
                    return {
                        "total": res.data.total,//总页数
                        "rows": res.data.list   //数据
                    };
                },
                onDblClickRow: function (row) {},
                columns: [
                    {
                        checkbox: "true",
                        field: 'check',
                        align: 'center'
                    },
                    {
                        title: '标题',
                        field: 'title',
                        align: 'center',
                        width: '60%',
                        formatter:function (val,row) {
                            return  '<a href="javascript:newsDetail('+row.id+');">'+row.title+'</a>';
                        }
                    },
                    {
                        title: '发布人',
                        field: 'author',
                        align: 'center',
                        width: '15%'
                    },
                    {
                        title: '发布时间',
                        field: 'newstime',
                        align: 'center',
                        width: '25%'
                    }
                ]
            });
        }
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        function newsDetail(id){
            layer.open({
                type: 2,
                title: '',
                shade: 0.5,
                skin: 'layui-layer-rim',
                area: ['900px', '450px'],
                shadeClose: false,
                closeBtn: 2,
                content: '/page/news/detail.shtm?id='+id
            });
        }
    </script>
</body>
</html>