<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>新增字典</title>
    <link href="../../../css/tail.css" rel="stylesheet" type="text/css">
    <link href="../../../plugin/bstable/css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>
<body style="border-radius: 8px;">
<form id="dicForm" target="submitFrame">
    <input type="hidden" name="sizeCode">
    <div class="top table2_top">
        <div>
            <div class="top_out" style="margin-top: 10px">
                <table class="table">
                    <tbody>
                    <tr>
                        <td>商品类型<span></span></td>
                        <td>
                            <select class="long_text" name="commondityType">
                                <option value="1">球鞋</option>
                                <option value="2">服装</option>
                                <option value="3">手表</option>
                                <option value="4">包</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>规格名称<span></span></td>
                        <td>
                            <input type="text" class="long_text" name="sizeName">
                        </td>
                    </tr>
                    <tr>
                        <td>序号<span></span></td>
                        <td>
                            <input type="hidden" name="sizeIndex">
                            <input type="text" class="long_text" id="sizeIndex" disabled>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="notice_bot">
            <div class="l_left"><input type="checkbox" checked="checked"/>保存并关闭窗口</div>
            <div class="r_right but_p">
                <button class="but_save" type="button">保存</button>
                <button class="but_close">关闭</button>
            </div>
        </div>
    </div>
</form>
<iframe id="submitFrame" style="display: none;width:0; height:0" name="submitFrame"  src="about:blank"></iframe>
<script src="../../../js/jquery-2.2.0.min.js"></script>
<script src="../../../plugin/layer_v2.1/layer/layer.js"></script>
<script>
    $(function () {
        loadNextIndex(1);
        //保存
        $(".but_save").on("click",function () {
            $.ajax({
                type: "POST",
                dataType: "json",
                url: "/dic/size/addOrUpdate.shtm",
                contentType: "application/x-www-form-urlencoded; charset=utf-8",
                data: $("#dicForm").serialize(),
                success: function (result) {
                    parent.layer.msg(result.msg);
                    if(result.code == 200){
                        $("input[name='sizeCode']").val(result.size.sizeCode);
                        parent.$("#dic_size").bootstrapTable('refresh');
                        if($(".notice_bot").find("input[type='checkbox']")[0].checked){
                            $(".but_close").click();
                        }
                    }
                }
            });
        });
        //关闭按钮
        $(".but_close").on("click",function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
        });

        //选择商品类别
        $("select[name='commondityType']").change(function(){
            var val = $(this).find("option:selected").val();
            loadNextIndex(val);
        });
    });

    /**
     * 根据商品类型加载下一个序列号
     * @param category
     */
    function loadNextIndex(category) {
        $.ajax({
            type: "post",
            dataType: "json",
            url: "/dic/size/getNextIndex.shtm",
            data: {category:category},
            success: function (value) {
                $("#sizeIndex").val(value);
                $("input[name='sizeIndex']").val(value);
            }
        });
    }
</script>
</body>
</html>
